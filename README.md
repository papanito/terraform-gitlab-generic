# tf-module-gitlab

Terraform module to simplify gitlab setup of groups and projects.

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.10.0, < 2.0.0 |
| <a name="requirement_gitlab"></a> [gitlab](#requirement\_gitlab) | >= 17.0.0, < 18.0.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_gitlab"></a> [gitlab](#provider\_gitlab) | >= 17.0.0, < 18.0.0 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [gitlab_group.groups](https://registry.terraform.io/providers/gitlabhq/gitlab/latest/docs/resources/group) | resource |
| [gitlab_project.repositories](https://registry.terraform.io/providers/gitlabhq/gitlab/latest/docs/resources/project) | resource |
| [gitlab_groups.groups](https://registry.terraform.io/providers/gitlabhq/gitlab/latest/docs/data-sources/groups) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_groups"></a> [groups](#input\_groups) | List of repositories. The list is written in a "generic" way, so we can use it for gitlab, github, .....<br/>Each entry contains<br/><br/><ul><li>`description`: (String) Description of the repo</li><br/><li>`avatar`: (String) File name of the avatar, assoumes it's in a subfolder `resources`</li><br/><li>`visibility_level`: (String) Set to public to create a public project. Valid values are `private`, `internal`, `public`.</li><br/><li>`gitlab`: (Boolean) if the repo shal be created in gitlab.</li><br/><li>`github`: (Boolean) if the repo shal be created in github.</li><br/><li>`auto_devops_enabled`: (Boolean)<br>Default to Auto DevOps pipeline for all projects within this group.</li><br/><li>`emails_enabled`: (Boolean) Enable email notifications.</li><br/><li>`default_branch`: (String) Initial<br>Default branch name.</li><br/><li>`extra_shared_runners_minutes_limit`: (Number) Additional CI/CD minutes for this group.</li><br/><li>`two_factor_grace_period`: (Number) Time before Two-factor authentication is enforced (in hours).</li><br/><li>`ip_restriction_ranges`: (List of String) A list of IP addresses or subnet masks to restrict group access. Will be concatenated together into a comma separated string. Only allowed on top level groups.<br/><li>`lfs_enabled`: (Boolean) Enable/disable Large File Storage (LFS) for the projects in this group.</li><br/><li>`membership_lock`: (Boolean) Users cannot be added to projects in this group.</li><br/><li>`mentions_disabled`:  (Boolean) Disable the capability of a group from getting mentioned.</li><br/><li>`path`: (String) Override path. This might be necessary to avoid duplication.<br>Default is the keyname of the the group element</li><br/><li>`parent_name`: "key" of the parent group from the group map</li><br/><li>`prevent_forking_outside_group`: (Boolean) When enabled, users can not fork projects from this group to external namespaces.</li><br/><li>`request_access_enabled`: (Boolean) Allow users to request member access.</li><br/><li>`require_two_factor_authentication`: (Boolean) Require all users in this group to setup Two-factor authentication.</li><br/><li>`share_with_group_lock`: (Boolean) Prevent sharing a project with another group within this group.</li><br/><li>`project_creation_level`: (String) Determine if developers can create projects in the group. Valid values are: `noone`, `owner`, `maintainer`, `developer`.</li><br/><li>`subgroup_creation_level`: String) Allowed to create subgroups. Valid values are: `owner`, `maintainer`.</li>`<br/><li>`wiki\_access\_level`:  (String) The group's wiki access level. Only available on Premium and Ultimate plans. Valid values are disabled, private, enabled.</li><br/><li>`default\_branch\_protection\_defaults`: (Block List, Max: 1) The default branch protection defaults </li><br/><li>`: (Boolean) if the repo shal be created in github.</li><ul> | <pre>map(object({<br/>    name             = optional(string)<br/>    description      = string<br/>    avatar           = optional(string)<br/>    visibility_level = string<br/><br/>    auto_devops_enabled                = optional(bool, false)<br/>    emails_enabled                     = optional(bool, false)<br/>    default_branch                     = optional(string, "main")<br/>    extra_shared_runners_minutes_limit = optional(number, 0)<br/>    two_factor_grace_period            = optional(number, 24)<br/>    require_two_factor_authentication  = optional(bool, true)<br/>    ip_restriction_ranges              = optional(list(string), [])<br/>    lfs_enabled                        = optional(bool, true)<br/>    membership_lock                    = optional(bool, true)<br/>    mentions_disabled                  = optional(bool, false)<br/>    path                               = optional(string)<br/>    parent_name                        = optional(string, null)<br/>    prevent_forking_outside_group      = optional(bool, false)<br/>    request_access_enabled             = optional(bool, false)<br/>    share_with_group_lock              = optional(bool, true)<br/>    project_creation_level             = optional(string, "owner")<br/>    subgroup_creation_level            = optional(string, "owner")<br/>    wiki_access_level                  = optional(string, "private")<br/>    default_branch_protection_defaults = optional(object({<br/>      allow_force_push           = bool<br/>      allowed_to_merge           = list(string) # developer, maintainer, no one.<br/>      allowed_to_push            = list(string) #string # developer, maintainer, no one.<br/>      developer_can_initial_push = bool<br/>      }),<br/>      {<br/>        allow_force_push           = false<br/>        allowed_to_merge           = ["maintainer"]<br/>        allowed_to_push            = ["developer", "maintainer"]<br/>        developer_can_initial_push = true<br/>    })<br/>  }))</pre> | n/a | yes |
| <a name="input_repositories"></a> [repositories](#input\_repositories) | List of repositories. The list is written in a "generic" way, so we can use it for gitlab, github, .....<br/>Each entry contains<br/><br/><ul><li>`description`: (String)Description of the repo</li><br/><li>`avatar`: (String) File name of the avatar, assoumes it's in a subfolder `resources`</li><br/><li>`gitlab`: (Boolean) if the repo shal be created in gitlab.</li><br/><li>`github`: (Boolean) if the repo shal be created in github.</li><br/><li>`archived`: (Boolean) if repo is marked as archived.</li><br/><li>`access_level`: (Object) object that contains access level</li><br/><li>`approvals_before_merge`: Number) Number of merge request approvals required for merging.><br/></ul><br/>**`access_level`**<br/><br/>Object contains a list of string. Valid values are `disabled`, `private`, `enabled`.<br/><br/><ul><li>`overall`: If specific setting below no specified, this setting is taken</li><br/><li>`analytics`: Set the analytics access level. </li><br/><li>`builds`: Set the builds access level.</li><br/><li>`container_registry`: Set visibility of container registry, for this project</li><br/><li>`environments`: Set the environments access level</li><br/><li>`feature_flags`: Set the feature flags access level</li><br/><li>`forking`: Set the forking access level.</li><br/><li>`infrastructure`: Set the infrastructure access level</li><br/><li>`issues`: Enable issue tracking for the project</li><br/><li>`merge_requests`: Set the merge requests access level</li><br/><li>`monitor`: Set the monitor access level. </li><br/><li>`packages`: Enable packages repository for the project</li><br/><li>`pages`: Enable pages access control. </li><br/><li>`releases`: Set the releases access level.</li><br/><li>`repository`: Set the repository access level.</li><br/><li>`requirements`: Set the requirements access level</li><br/><li>`snippets`: Set the snippets access level.</li><br/><li>`security_and_compliance`: </li><br/><li>`visibility_level`:  Set to public to create a public project. Valid values are `private`, `internal`, `public`.<br/><li>`wiki`: Set the wiki access level</li></ul><br/><br/>**Remarks**<br/><br/>`public_jobs` will be set according to `builds` access level | <pre>map(object({<br/>    name                   = optional(string)<br/>    description            = string<br/>    group_name             = optional(string)<br/>    avatar                 = optional(string)<br/>    gitlab                 = optional(bool, false)<br/>    github                 = optional(bool, false)<br/>    archived               = optional(bool, false)<br/>    approvals_before_merge = optional(number, 1)<br/>    access_level = object({<br/>      overall                 = string<br/>      analytics               = string<br/>      builds                  = string<br/>      container_registry      = string<br/>      environments            = string<br/>      feature_flags           = string<br/>      forking                 = string<br/>      infrastructure          = string<br/>      issues                  = string<br/>      merge_requests          = string<br/>      monitor                 = string<br/>      packages                = string<br/>      pages                   = string<br/>      releases                = string<br/>      repository              = string<br/>      requirements            = string<br/>      snippets                = string<br/>      security_and_compliance = string<br/>      visibility_level        = string<br/>      wiki                    = string<br/>    })<br/>    default_branch = optional(string)<br/>    import_url     = optional(string)<br/>    tags           = list(string)<br/>    }<br/>  ))</pre> | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_groups"></a> [groups](#output\_groups) | n/a |
<!-- END_TF_DOCS -->